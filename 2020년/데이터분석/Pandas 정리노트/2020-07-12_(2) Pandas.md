## [Pandas] 누락된 데이터 처리

​	누락 데이터를 처리하는 파이썬의 내장된 Pandas 도구 몇 가지를 설명한다.



### Pandas 에서 누락된 데이터 처리

​	None, NaN 이 있다. 다만 None 으로 처리할 경우, Object로 인식. 숫자 연산 하나도 안 된다. NaN을 사용하자. 하지만 적절하게 둘은 호환된다. Pandas 에서 알아서 쓰임새에 맞게 변환해준다.`

#### NaN (Not a Number)

```python
import pandas as pd
import numpy as np

vals = np.array([1, np.nan, 3, 4])
vals.dtype
# dtype('float64')
```

```python
1 + np.nan		# nan

vals.sum(), vals.min(), vals.max()
# (nan, nan, nan)

# 특수한 방식, NaN 무시하고 계산한다.
np.nansum(vals), np.nanmin(vals), np.nanmax(vals), np.nanmean(vals)
(8.0, 1.0, 4.0, 2.6666666666666665)
```



#### NA 값 도입시 Pandas 상향 변환 규칙

| 타입 클래스 | NA 값 저장할 때의 변환 | NA 센티널 값     |
| ----------- | ---------------------- | ---------------- |
| floating    | 변경 없음              | np.nan           |
| object      | 변경 없음              | None 또는 np.nan |
| integer     | float64로 변환         | np.nan           |
| Boolean     | object로 변환          | None 또는 np.nan |



---



### 널 값 연산

​	Pandas 데이터 구조의 널 값을 감지하고 삭제하고 대체하는 몇 가지 유용한 메서드가 있다.

- isnull() - 누락 값을 가리키는 부울 마스크를 생성
- notnull() - isnull()의 역
- dropna() - 데이터에 필터를 적용한 버전을 반환
- fillna() - 누락 값을 채우거나 전가된 데이터 사본을 반환



##### Null 값 제거

```python
df = pd.DataFrame([[1, np.nan, 2],
                    [2, 3, 5],
                    [np.nan, 4, 6]])

df
```

|      |    0 |    1 |    2 |
| ---: | ---: | ---: | ---: |
|    0 |  1.0 |  NaN |    2 |
|    1 |  2.0 |  3.0 |    5 |
|    2 |  NaN |  4.0 |    6 |

```python
df.dropna()
```

|      |    0 |    1 |    2 |
| ---: | ---: | ---: | ---: |
|    1 |  2.0 |  3.0 |    5 |

```python
# 열 방향 연산
df.dropna(axis=1)
```

|      |    2 |
| ---: | ---: |
|    0 |    2 |
|    1 |    5 |
|    2 |    6 |

​	how, thresh를 이용하여 세밀하게 drop 가능

- how : 어떻게 지울지. 기본값은 how=any, 있으면 다 지운다...
- thresh : NaN 제외한 값이 최소 thresh N 개 이상인 것만 남긴다.

```python
df[3] = np.nan
df
```

|      |    0 |    1 |    2 |    3 |
| ---: | ---: | ---: | ---: | ---: |
|    0 |  1.0 |  NaN |    2 |  NaN |
|    1 |  2.0 |  3.0 |    5 |  NaN |
|    2 |  NaN |  4.0 |    6 |  NaN |

```python
df.dropna(axis=1, how='all')
```

|      |    0 |    1 |    2 |
| ---: | ---: | ---: | ---: |
|    0 |  1.0 |  NaN |    2 |
|    1 |  2.0 |  3.0 |    5 |
|    2 |  NaN |  4.0 |    6 |

```python
df.dropna(axis=0, thresh=3)
```

|      |    0 |    1 |    2 |    3 |
| ---: | ---: | ---: | ---: | ---: |
|    1 |  2.0 |  3.0 |    5 |  NaN |



##### Null 값 채우기

​	fillna() 메서드를 이용하여 처리한다.

```python
data = pd.Series([1, np.nan, 2, None, 3], index=list('abcde'))
data
# a    1.0
# b    NaN
# c    2.0
# d    NaN
# e    3.0
# dtype: float64
```

```python
data.fillna(0)
# a    1.0
# b    0.0
# c    2.0
# d    0.0
# e    3.0
# dtype: float64
```

```python
# 이 전 값으로 (forward fill)
data.fillna(method='ffill')
# a    1.0
# b    1.0
# c    2.0
# d    2.0
# e    3.0
# dtype: float64
```

```python
# 이 후 값으로 (back fill)
data.fillna(method='bfill')
# a    1.0
# b    2.0
# c    2.0
# d    3.0
# e    3.0
# dtype: float64
```

​	dataFrame의 경우 Series와 동일하지만, 축의 방향을 지정할 수 있다.

|      |    0 |    1 |    2 |    3 |
| ---: | ---: | ---: | ---: | ---: |
|    0 |  1.0 |  NaN |    2 |  NaN |
|    1 |  2.0 |  3.0 |    5 |  NaN |
|    2 |  NaN |  4.0 |    6 |  NaN |

```python
df.fillna(method='ffill', axis=1)
```

|      |       0 |    1 |    2 |    3 |
| ---: | ------: | ---: | ---: | ---: |
|    0 |     1.0 |  1.0 |  2.0 |  2.0 |
|    1 |     2.0 |  3.0 |  5.0 |  5.0 |
|    2 | **NaN** |  4.0 |  6.0 |  6.0 |



---



### 계층적 인덱싱

